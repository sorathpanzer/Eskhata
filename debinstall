#!/bin/bash

USERNAME=""
PASSWORD=""

apt install -y extlinux syslinux
mkdir /boot/extlinux
cp -r /lib/syslinux/modules/bios /boot/extlinux

cat <<EOF > /boot/extlinux/extlinux.conf
DEFAULT Debian

LABEL Debian
	KERNEL /boot/$(ls /boot | grep vmlinuz)
	APPEND root=/dev/sda1 rw
	INITRD /boot/$(ls /boot | grep initrd)
EOF

cat /lib/syslinux/mbr/mbr.bin > /dev/sda
extlinux --install /boot/extlinux

apt-get purge -y libfreetype6 libfuse2 libpng16-16 grub

cat <<EOF > /etc/apt/apt.conf.d/01norecommends
APT::Install-Recommends "0";
APT::Install-Suggests "0";
APT::AutoRemove::RecommendsImportant "0";
APT::AutoRemove::SuggestsImportant "0";
EOF

echo "kernel.perf_cpu_time_max_percent = 0" >> /etc/sysctl.conf

apt autoremove -y
apt install -y chromium chromium-l10n stow
apt install -y git ca-certificates curl

printf "$PASSWORD\n$PASSWORD" | sudo -Hu $USERNAME git clone https://gitea.com/sorathpanzer/dotgit.git /home/$USERNAME/.config/dotgit
printf "$PASSWORD\n$PASSWORD" | sudo -Hu $USERNAME mkdir -p /home/$USERNAME/.cache/zsh
printf "$PASSWORD\n$PASSWORD" | sudo -Hu $USERNAME touch /home/$USERNAME/.cache/zsh/history
rm $HOME/.profile
printf "$PASSWORD\n$PASSWORD" | sudo -Hu $USERNAME sh -c "cd /home/$USERNAME/.config/dotgit; stow -vt ~ dotfiles"
printf "$PASSWORD\n$PASSWORD" | sudo -Hu $USERNAME sh -c "curl -L https://github.com/gokcehan/lf/releases/download/r24/lf-linux-amd64.tar.gz | tar xzC ~/.local/bin"

apt install -y build-essential libx11-dev libxft-dev libxinerama-dev libimlib2-dev libexif-dev xorg xauth
apt install -y udiskie x11-xserver-utils xinput pulseaudio pulseaudio-utils pulsemixer hsetroot ntfs-3g fuse picom numlockx xdotool man
apt install -y zsh zsh-syntax-highlighting zsh-autosuggestions fzf exa bat doas trash-cli youtube-dl mpv xclip neovim

git clone https://github.com/Earnestly/sx
cd sx
make PREFIX=/usr install
cd
